"use strict";var attachSearch=function(){var e=$(".geocoder-control").parent().attr("id"),t=$(".geocoder-control"),a=$(window).width();a<992&&"geocodeMobile"!==e?(t.detach(),$("#geocodeMobile").append(t)):a>=992&&"geocode"!==e&&(t.detach(),$("#geocode").append(t))};$("#search-btn").click((function(){$("#searchModal").modal("show")})),$("#about-btn").click((function(){$("#aboutModal").modal("show")})),$("#legend-btn").click((function(){$("#legendModal").modal("show")})),$("#disclaimer-btn").click((function(){$("#disclaimerModal").modal("show")})),$("#std-filter-btn").click((function(){$("#filterModal").modal("show")})),$("#year-filter-btn").click((function(){$("#filterYearModal").modal("show")})),$("#multi-year-filter-btn").click((function(){$("#filterMultiYearModal").modal("show")})),$("#muni-zoom-btn").click((function(){$("#muniZoomModal").modal("show")}));var resetDefaultOptionElement=function(e){$("#"+e+" option").prop("selected",(function(){return this.defaultSelected}))},setFilterUIWidgetContent=function(e,t){var a=document.getElementById("startDateUI"),o=document.getElementById("endDateUI");a.innerHTML=e,o.innerHTML=t},years=["Select Year","2019","2020","2021"],targetIds=["plansSelectedYear","plansStartYear","plansEndYear"],date=new Date,yearDate=date.getFullYear(),psuedoDate=2030;function addDates(e,t){console.log(years);var a=parseInt(years[years.length-1],10);console.log(a);for(var o=a+1;o<e;o++){var n=document.getElementById(t),r="<option value=".concat(o.toString(),">").concat(o,"</option>");n.insertAdjacentHTML("beforeend",r)}}for(var i=0;i<targetIds.length;i++)addDates(yearDate+1,targetIds[i]);$(document).ready((function(){$("#selectMuni").on("change",(function(e){zoomToMuni($(this).val())})),attachSearch(),$(window).resize((function(){attachSearch()}))}));var setPopupMaxHeight=function(e){return e<315e3?150:500},setPopupMaxWidth=function(e){return e<450?240:300},returnAltTextForLegend=function(e,t){return'alt="legend icon representing '.concat(""===t||" "===t?e:t,'"')},createMapLegend=function(e,t){L.esri.dynamicMapLayer({url:e}).legend((function(e,a){var o="";e?o+="<h4>There was an error creating the legend</h4>":a.layers.forEach((function(e){o+="<ul>",o+="<li><strong>".concat(e.layerName,"</strong></li>"),e.legend.forEach((function(t){var a=returnAltTextForLegend(e.layerName,t.label);o+=L.Util.template("<li><img "+a+' width="{width}" height="{height}" src="data:{contentType};base64,{imageData}"><span>{label}</span></li>',t)})),o+="</ul>"})),$(t).prepend(o)}))},returnDomainText=function(e){var t;switch(e){case 1:t="Residential";break;case 2:t="Lot Addition";break;case 3:t="Commerical";break;case 4:t="Industrial";break;case 5:t="Agriculture";break;case 6:t="Institutional";break;default:t="Vacant"}return t},convertJSONDateToString=function(e){var t;if(e){var a=/-?\d+/.exec(e),o=new Date(parseInt(a[0])),n=o.getMonth()+1,r=n>9?n:"0"+n,i=o.getDate(),s=i>9?i:"0"+i,l=o.getFullYear();t="".concat(r,"-").concat(s,"-").concat(l)}return t},testforFiedlValues=function(e,t){return null!==e&&""!==e?e:t},returnNumberWithCommas=function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},zoomToMuni=function(e){var t="MUNI = '".concat(e,"'");L.esri.query({url:"https://services1.arcgis.com/1Cfo0re3un0w6a30/arcgis/rest/services/Municipal_Boundaries/FeatureServer/0"}).where(t).bounds((function(e,t,a){e?(console.warn("An error with the query request has occured"),console.warn("Code: ".concat(e.code,"; Message: ").concat(e.message))):a.features<1?console.log("No features selected"):map.fitBounds(t)})),$("#muniZoomModal").modal("hide")},processLoadEvent=function(e){e.on("requestsuccess",(function(t){e.options.isLoaded=!0})),e.on("requesterror",(function(t){t.url==e.options.url&&(e.options.isLoaded=!1,console.warn("Layer failed to load: ".concat(e.options.url)),console.warn("Code: ".concat(t.code,"; Message: ").concat(t.message)),$("#layerErrorModal").modal("show"))}))},setDateQuery=function(e,t){return"DATE >= date '".concat(e,"' AND DATE <= date '").concat(t,"'")};$((function(){var e=function(e){var a;try{a=$.datepicker.parseDate(t,e.value)}catch(e){a=null,$("#dateErrorModal").modal("show")}return a},t="mm/dd/yy",a=$("#fromDate").datepicker({defaultDate:"0",changeMonth:!0,numberOfMonths:1}).on("change",(function(){o.datepicker("option","minDate",e(this))})),o=$("#toDate").datepicker({defaultDate:"0",changeMonth:!0,numberOfMonths:1}).on("change",(function(){a.datepicker("option","maxDate",e(this))}))}));var windowWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,windowHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,windowArea=windowWidth*windowHeight,homeCoords=[40.15,-77.25],spcPACrs=new L.Proj.CRS("EPSG:2272","+proj=lcc +lat_1=40.96666666666667 +lat_2=39.93333333333333 +lat_0=39.33333333333334 +lon_0=-77.75 +x_0=600000 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs",{origin:[-119214200,146166900],resolutions:[260.41666666666663,86.80555555555556,43.40277777777778,20.833333333333332,10.416666666666666,6.944444444444444,4.166666666666666,2.083333333333333,1.0416666666666665,.5208333333333333]}),map=L.map("map",{center:homeCoords,zoom:0,zoomControl:!1,crs:spcPACrs,minZoom:0,maxZoom:8}),zoomHomeControl=L.Control.zoomHome({position:"topleft",zoomHomeTitle:"Full map extent",homeCoordinates:homeCoords,homeZoom:0}).addTo(map),fullscreenControl=new L.Control.Fullscreen({position:"topleft"}).addTo(map),startDate="01-01-",endDate="12-31-",currentYear=(new Date).getFullYear(),intialStartDate=startDate+currentYear,initialEndDate=endDate+currentYear,initialWhereClause=setDateQuery(intialStartDate,initialEndDate),imagery2020=L.esri.tiledMapLayer({url:"https://gis.ccpa.net/arcgiswebadaptor/rest/services/Imagery/Imagery2020/MapServer",maxZoom:8,minZoom:0,continuousWorld:!0,attribution:"Cumberland County",errorTileUrl:"//downloads2.esri.com/support/TechArticles/blank256.png",isLoaded:!1}),roadsMunicipality=L.esri.tiledMapLayer({url:"https://gis.ccpa.net/arcgiswebadaptor/rest/services/Property_Assessment/Roads_Municipal_Boundaries/MapServer",maxZoom:8,minZoom:0,continuousWorld:!0,attribution:"Cumberland County",errorTileUrl:"//downloads2.esri.com/support/TechArticles/blank256.png",isLoaded:!1}),planSubmissions=L.esri.featureLayer({url:"https://gis.ccpa.net/arcgiswebadaptor/rest/services/Planning/Auto_Reviewed_SALDO_Plans_Public/MapServer/0",where:initialWhereClause,onEachFeature:function(e,t){windowArea<315e3&&(t.on("popupopen",(function(){$("div.leaflet-top").css("opacity",0),$("div.leaflet-bottom").css("opacity",0)})),t.on("popupclose",(function(){$("div.leaflet-top").css("opacity",1),$("div.leaflet-bottom").css("opacity",1)})))},isLoaded:!1});planSubmissions.bindPopup((function(e,t){var a=e.feature.properties.DATE,o=convertJSONDateToString(a),n=e.feature.properties.LANDUSE,r=returnDomainText(n),i=e.feature.properties.SQFT,s=testforFiedlValues(i,"N/A");"N/A"!==s&&(s=returnNumberWithCommas(i));var l=e.feature.properties.UNITS,c=testforFiedlValues(l,"N/A"),d=e.feature.properties.PLNLINK,u=testforFiedlValues(d,"Plan not available");"Plan not available"!==u&&(u='<a target="_blank" rel="noopener" href="'.concat(d,'">View Electronic Plan</a>'));var p='<div class="feat-popup">';return p+='<h3><span class="gray-text">Plan Name:</span> {NAME}</h3>',p+="<ul>",p+='<li><span class="gray-text">Land Use:</span> '.concat(r,"</li>"),p+='<li><span class="gray-text">Date Received:</span> '.concat(o,"</li>"),p+='<li><span class="gray-text">Square Footage:</span> '.concat(s,"</li>"),p+='<li><span class="gray-text">Number of Proposed Units:</span> '.concat(c,"</li>"),p+='<li><span class="gray-text">Plan & Comments (pdf):</span> '.concat(u,"</li>"),p+="</ul>",p+="<h4><strong>Description:</strong></h4>",p+="<p>{DESCRIPTION}</p>",p+="</div>",L.Util.template(p,e.feature.properties)}),{closeOnClick:!0,maxHeight:setPopupMaxHeight(windowArea),maxWidth:setPopupMaxWidth(windowWidth)});var mapServices=[imagery2020,roadsMunicipality,planSubmissions];function clearFilter(){planSubmissions.setWhere(initialWhereClause),setFilterUIWidgetContent(intialStartDate,initialEndDate),$("#filterModal").modal("hide"),planSubmissions.refresh()}function setFilter(){var e=$("#fromDate").val(),t=$("#toDate").val(),a="DATE >= date '".concat(e,"' AND DATE <= date '").concat(t,"'");planSubmissions.setWhere(a),setFilterUIWidgetContent(e,t),$("#filterModal").modal("hide"),planSubmissions.refresh()}mapServices.forEach((function(e){return processLoadEvent(e)})),mapServices.forEach((function(e){return e.addTo(map)})),setFilterUIWidgetContent(intialStartDate,initialEndDate),createMapLegend("https://gis.ccpa.net/arcgiswebadaptor/rest/services/Property_Assessment/Roads_Municipal_Boundaries/MapServer","#map-legend-content"),createMapLegend("https://gis.ccpa.net/arcgiswebadaptor/rest/services/Planning/Auto_Reviewed_SALDO_Plans_Public/MapServer","#map-legend-content"),$("#setFilter").click(setFilter),$("#clearFilter").click(clearFilter),$("#plansSelectedYear").on("change",(function(e){var t=$(this).val(),a=startDate+t,o=endDate+t,n=setDateQuery(a,o);planSubmissions.setWhere(n),$("#panelSelectByYearFilter").collapse("hide"),resetDefaultOptionElement("plansSelectedYear"),setFilterUIWidgetContent(a,o),$("#filterYearModal").modal("hide"),planSubmissions.refresh()})),$("#setFilterMultipleYears").on("click",(function(e){var t=$("#plansStartYear").val(),a=$("#plansEndYear").val(),o=startDate+t,n=endDate+a,r=setDateQuery(o,n);planSubmissions.setWhere(r),$("#panelSelectByStartEndYearFilter").collapse("hide"),resetDefaultOptionElement("plansStartYear"),resetDefaultOptionElement("plansEndYear"),setFilterUIWidgetContent(o,n),$("#filterMultiYearModal").modal("hide"),planSubmissions.refresh()}));var ccpaProvider=L.esri.Geocoding.geocodeServiceProvider({label:"Street Addresses",maxResults:8,attribution:"Cumberland County",url:"https://gis.ccpa.net/arcgiswebadaptor/rest/services/Locators/Composite_Address_Locator/GeocodeServer"}),featureLayerProvider=L.esri.Geocoding.featureLayerProvider({url:"https://gis.ccpa.net/arcgiswebadaptor/rest/services/Planning/Reviewed_SALDO_Plans_Public/MapServer/0",label:"Submitted Plans",maxResults:8,searchFields:["NAME"],formatSuggestion:function(e){return e.properties.NAME}}),addressSearchControl=L.esri.Geocoding.geosearch({useMapBounds:!1,providers:[featureLayerProvider,ccpaProvider],placeholder:"Search by Plan or Street Address",title:"Search Tool",expanded:!0,collapseAfterResult:!1,zoomToResult:!1}).addTo(map);addressSearchControl.on("results",(function(e){if(e.results.length>0){map.setView(e.results[0].latlng,7);L.popup({closeOnClick:!0}).setLatLng(e.results[0].latlng).setContent(e.results[0].text).openOn(map)}else L.popup({closeOnClick:!0}).setLatLng(map.getCenter()).setContent("No results were found. Please try a different address.").openOn(map);$("#searchModal").modal("hide")}));var locateControl=L.control.locate({position:"topleft",drawCircle:!0,follow:!1,setView:!0,keepCurrentZoomLevel:!1,markerStyle:{weight:1,opacity:.8,fillOpacity:.8},circleStyle:{weight:1,clickable:!1},icon:"fa fa-location-arrow",iconLoading:"fa fa-spinner fa-spin",metric:!1,onLocationError:function(e){alert(e.message)},onLocationOutsideMapBounds:function(e){alert(e.options.strings.outsideMapBoundsMsg)},strings:{title:"Find my location",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem to be located outside the boundaries of the map"},locateOptions:{maxZoom:18,watch:!0,enableHighAccuracy:!0,maximumAge:1e4,timeout:1e4}}).addTo(map),loadScreenTimer=window.setInterval((function(){var e=$("#back-cover"),t=imagery2020.options.isLoaded,a=roadsMunicipality.options.isLoaded,o=planSubmissions.options.isLoaded;t&&a&&o?(window.setTimeout((function(){e.fadeOut("slow")}),500),window.clearInterval(loadScreenTimer)):console.log("layers still loading")}),1500);$("#layerErrorModal").on("hide.bs.modal",(function(e){$("#back-cover").fadeOut("slow"),window.clearInterval(loadScreenTimer)}));